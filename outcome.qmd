---
title: "Team Assignment #3: Outcome"
code-fold: true
editor_options: 
  chunk_output_type: console
---

```{r load-data}
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(kableExtra))
suppressPackageStartupMessages(library(survival))
suppressPackageStartupMessages(library(ggsurvfit))

suppressPackageStartupMessages(library(targets))

tar_load(df)
tar_load(lista_zmiennych)
tar_load(df_trtmt)
```

# Założenia

W grupie osób leczonych chcemy zidentyfikować osoby, które dobrze odpowiedziały na leczenie i określić, które cechy były predyktorami tej dobrej odpowiedzi.

Dobrą odpowiedź na leczenie definiujemy jako

* przeżycie >=2 lata i brak hospitalizacji z powodu zaostrzenia CHF przez >=2 lata 
licząc od czasu ranodmizacji w badaniu

# Implementacja

W zbiorze danych DIG jednym z punktów końcowych był "zgon lub hospitalizacja z powodu zaostrzenia nwd. serca". Ten punkt końcowy reprezentowany jest przez następujące zmienne:  

```{r}
  lista_zmiennych %>%
    filter(
      var_names %in% c("dwhf", "dwhfdays")
    ) %>% 
    kable() %>%
    kable_classic_2()
```

# Podstawowe statystyki 

```{r}
m0 <- survfit(Surv(dwhfdays,dwhf)~1, data= df_trtmt)
```

## Liczba osób

```{r}
n_total <- nrow(df_trtmt)
n_total
```

## Sumaryczna liczba eventów

```{r}
n_events <- sum(df_trtmt$dwhf)
n_events
```


## Liczba obserwacji uciętych

```{r}
n_censored <- n_total - n_events
n_censored
```


## Czas obserwacji 

### Dni
```{r}
summary(df_trtmt$dwhfdays)
```

### Lata
```{r}
summary(df_trtmt$dwhfdays / 365.25)
```

## Skumulowana częstość występowania

```{r}
m0 %>%
  ggsurvfit() +
  add_confidence_interval() +
  add_risktable() +
  labs(
    title = "Cumulative Incidence Curve",
    x = "Time (days)",  # adjust if needed
    y = "Cumulative event probability"
  ) +
  scale_y_reverse(trans = "reverse")  # flip survival to mortality
```


## Mediana przeżycia

```{r}
summary(m0)$table["median"]
```

## 2-letnie przeżycia

```{r}
summary(m0, times = 2*365.25)
```


 
